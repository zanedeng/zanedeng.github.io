import{a as e,d as t,b as i,c as s,g as o}from"./theme.BxpiuCfN.js";import{n}from"./nextFrame-BGGLuZuD.CXhuHsRE.js";import{t as a}from"./error-DAO_9P5C.C0uiOAou.js";import{i as h}from"./isClient-VXT6p8t0.BWwfHtBD.js";import{b as r}from"./uuid-BZTOj-_U.D3oPmf8g.js";import{u as l}from"./useNamespace-HoRSxEcr.Ve2NNMUK.js";import{m as d}from"./typescript-B-rxnVJv.CRqm1_SZ.js";import{f as g}from"./constants-DPmqmB4-.u4_4CECv.js";import{d as c}from"./debounce-BnmERUdf.gCOUq2Qp.js";import"./framework.N_gL8lMw.js";import"./isString-DaEH0FEg.BuzQwn6C.js";import"./toObjectString-D4ItlKpz.B_ykxbfz.js";const u={backspace:"Backspace",delete:"Delete",down:"ArrowDown",end:"End",enter:"Enter",esc:"Escape",home:"Home",left:"ArrowLeft",numpadEnter:"NumpadEnter",pageDown:"PageDown",pageUp:"PageUp",right:"ArrowRight",space:"Space",tab:"Tab",up:"ArrowUp"},p=e=>{let t=e.key&&"Unidentified"!==e.key?e.key:"";if(!t&&"keyup"===e.type&&h&&/android/i.test(window.navigator.userAgent)){const i=e.target;t=i.value.charAt(i.selectionStart-1)}return t},m=()=>{};var b=Array.isArray;const f=l("autocomplete"),v=class{constructor(i){e(this,i),this.blurEvent=t(this,"zBlur",7),this.changeEvent=t(this,"zChange",7),this.clearEvent=t(this,"zClear",7),this.focusEvent=t(this,"zFocus",7),this.inputEvent=t(this,"zInput",7),this.selectEvent=t(this,"zSelect",7),this.autosize=!1,this.clearIcon="circle-close",this.debounce=300,this.disabled=void 0,this.dropdownWidth="",this.fetchSuggestions=m,this.hasFooter=!1,this.hasHeader=!1,this.highlightedIndex=-1,this.inputStyle=d({}),this.loading=!1,this.loopNavigation=!0,this.placement="bottom-start",this.popperTheme="autocomplete",this.rows=2,this.suggestionDisabled=!1,this.suggestions=[],this.triggerOnFocus=!0,this.type="text",this.validateEvent=!0,this.value="",this.valueKey="value",this.wordLimitPosition="inside",this.zTabindex=0,this.debouncedGetData=c(this.getData,this.debounce),this.ignoreFocusEvent=!1,this.listboxId=r(),this.readonly=!1,this.appendTo=()=>null===document||void 0===document?void 0:document.body,this.getSuggestionContext=()=>{var e;const t=null===(e=this.regionRef)||void 0===e?void 0:e.querySelector(`.${f.be("suggestion","wrap")}`),i=t.querySelectorAll(`.${f.be("suggestion","list")} li`);return[t,i]},this.handleBlur=e=>{n(()=>{this.blurEvent.emit(e.detail)})},this.handleChange=e=>{this.changeEvent.emit(e.detail)},this.handleClear=()=>{this.value="",this.changeEvent.emit(""),this.clearEvent.emit()},this.handleClickOutside=()=>{this.popperRef.hide()},this.handleFocus=e=>{var t;if(this.ignoreFocusEvent)this.ignoreFocusEvent=!1;else{this.focusEvent.emit(e.detail);const i=null!==(t=this.value)&&void 0!==t?t:"";this.triggerOnFocus&&!this.readonly&&(this.suggestions=[],this.popperRef.show(),this.debouncedGetData(String(i)))}},this.handleHide=()=>{this.highlightedIndex=-1},this.handleInput=e=>{const t=e.detail;if(this.inputEvent.emit(t),this.suggestionDisabled=!1,!this.triggerOnFocus&&!t)return this.suggestionDisabled=!0,void(this.suggestions=[]);this.popperRef.isVisible().then(e=>{e||this.popperRef.show()}),this.debouncedGetData(t)},this.handleKeydown=e=>{switch((e=>{if(e.code&&"Unidentified"!==e.code)return e.code;const t=p(e);return t?Object.values(u).includes(t)?t:" "===t?u.space:"":""})(e)){case u.down:e.preventDefault(),this.highlight(this.highlightedIndex+1);break;case u.end:e.preventDefault(),this.highlight(this.suggestions.length-1);break;case u.enter:case u.numpadEnter:e.preventDefault(),this.handleKeyEnter();break;case u.esc:this.handleKeyEscape(e);break;case u.home:e.preventDefault(),this.highlight(0);break;case u.pageDown:e.preventDefault(),this.highlight(Math.min(this.suggestions.length-1,this.highlightedIndex+10));break;case u.pageUp:e.preventDefault(),this.highlight(Math.max(0,this.highlightedIndex-10));break;case u.tab:this.close();break;case u.up:e.preventDefault(),this.highlight(this.highlightedIndex-1)}},this.handleKeyEscape=e=>{e.preventDefault(),e.stopPropagation(),this.popperRef.hide()},this.handleLoadingRender=()=>{n(()=>{const e=this.loadingRender(),t=document.querySelector(`[id="${this.listboxId}-loading"]`);t&&e&&(t.innerHTML=e.innerHTML)})},this.handleShow=()=>{this.dropdownWidth=`${this.inputRef.offsetWidth}px`},this.handleSuggestionItemRender=(e,t)=>{n(()=>{const i=this.suggestionRender(e),s=document.querySelector(`[id="${this.listboxId}-item-${t}"]`);s&&i&&s.append(i)})}}get formContext(){let e=this.el.parentElement,t=null;for(;e;){if("ZANE-FORM"===e.tagName){t=g.get(e);break}e=e.parentElement}return t}async close(){var e;null===(e=this.popperRef)||void 0===e||e.hide()}componentWillLoad(){this.hasFooter=!!this.el.querySelector('[slot="footer"]'),this.hasHeader=!!this.el.querySelector('[slot="header"]')}async getData(e){if(this.suggestionDisabled)return;const t=e=>{this.loading=!1,this.suggestionDisabled||(b(e)?(this.suggestions=e,this.highlightedIndex=this.highlightFirstItem?0:-1):a("zane-autocomplete","autocomplete suggestions must be an array"))};if(this.loading=!0,b(this.fetchSuggestions))t(this.fetchSuggestions);else{const i=await this.fetchSuggestions(e,t);b(i)&&t(i)}}async handleKeyEnter(){var e;(null===(e=this.inputRef)||void 0===e?void 0:e.isComposing)||(this.highlightedIndex>=0&&this.highlightedIndex<this.suggestions.length?this.handleSelect(this.suggestions[this.highlightedIndex]):(this.selectWhenUnmatched&&(this.selectEvent.emit(this.value),this.suggestions=[],this.highlightedIndex=-1),this.debouncedGetData(String(this.value))))}async handleSelect(e){this.inputEvent.emit(e[this.valueKey]),this.value=e[this.valueKey],this.selectEvent.emit(e),this.suggestions=[],this.highlightedIndex=-1,this.popperRef.hide()}async highlight(e){var t;if(this.loading)return;if(e<0){if(!this.loopNavigation)return void(this.highlightedIndex=-1);e=this.suggestions.length-1}e>=this.suggestions.length&&(e=this.loopNavigation?0:this.suggestions.length-1);const[i,s]=this.getSuggestionContext(),o=s[e],n=i.scrollTop,{offsetTop:a,scrollHeight:h}=o;a+h>n+i.clientHeight&&(i.scrollTop=a+h-i.clientHeight),a<n&&(i.scrollTop=a),this.highlightedIndex=e,null===(t=this.inputRef)||void 0===t||t.setAttribute("aria-activedescendant",`${this.listboxId}-item-${this.highlightedIndex}`)}async inputBlur(){var e;null===(e=this.inputRef)||void 0===e||e.blur()}async inputFocus(){var e;null===(e=this.inputRef)||void 0===e||e.focus()}render(){return i(s,{key:"52a7621e97a06ea631ed7b55548a4fdfd00470e6"},i("zane-tooltip",{key:"2601cf2059a12661554c82b6277e574e9c2627fc",appendTo:this.appendTo,arrow:!1,hideOnClick:!1,interactive:!0,maxWidth:this.dropdownWidth,offset:[0,1],onZClickOutside:this.handleClickOutside,onZHide:this.handleHide,onZShow:this.handleShow,placement:this.placement,ref:e=>this.popperRef=e,role:"listbox",theme:this.popperTheme,trigger:"manual"},i("div",{key:"aaa415eec77a3e4bdcd1b3693d3ec881ed2deda6",class:{[f.b()]:!0,[f.is("loading",!this.hideLoading&&this.loading)]:!0,[this.el.className]:!0},style:{outline:"none",[this.fitInputWidth?"width":"minWidth"]:this.dropdownWidth}},i("zane-input",{key:"d15a21583e240e827b6233b6ec03632dc103ace8",ariaLabel:this.ariaLabel,autosize:this.autosize,clearable:this.clearable,clearIcon:this.clearIcon,disabled:this.getInputDisabled(),form:this.form,formatter:this.formatter,inputStyle:this.inputStyle,max:this.max,maxLength:this.maxLength,min:this.min,minLength:this.minLength,name:this.name,onKeyDown:this.handleKeydown,onZBlur:this.handleBlur,onZChange:this.handleChange,onZClear:this.handleClear,onZFocus:this.handleFocus,onZInput:this.handleInput,parser:this.parser,placeholder:this.placeholder,prefixIcon:this.prefixIcon,readonly:this.readonly,ref:e=>this.inputRef=e,resize:this.resize,rows:this.rows,showPassword:this.showPassword,showWordLimit:this.showWordLimit,size:this.size,step:this.step,suffixIcon:this.suffixIcon,type:this.type,validateEvent:this.validateEvent,value:this.value,wordLimitPosition:this.wordLimitPosition,zInputMode:this.zInputMode,zTabindex:this.zTabindex},i("slot",{key:"ff1d195faed4420e8f494b3a06bd3ea01bdd287d",name:"prepend",slot:"prepend"}),i("slot",{key:"6f39bf97a68555129a5a27c38009d517bcada971",name:"append",slot:"append"}),i("slot",{key:"3968fb8798a6543b7656fbe9af0e4728840b43f8",name:"prefix",slot:"prefix"}),i("slot",{key:"830b56e826a086f4d9760477c889d351bae27502",name:"suffix",slot:"suffix"}))),i("div",{key:"2380801ac5a64e9a29ec7812b2bb50012b116dc2",slot:"content"},i("div",{key:"23e1f1e320f39579542d53ed625d7f1ad913004a",class:{[f.b("suggestion")]:!0,[f.is("loading",!this.hideLoading&&this.loading)]:!0},ref:e=>this.regionRef=e,role:"region",style:{outline:"none",[this.fitInputWidth?"width":"minWidth"]:this.dropdownWidth}},this.hasHeader&&i("div",{key:"3014d7eee62dc32a06fb9bf920a6301be5edec0c",class:f.be("suggestion","header"),onClick:e=>e.stopPropagation()},i("slot",{key:"4eaee070c7273cab598c540ffc2d274b222d76e9",name:"header"})),i("zane-scrollbar",{key:"e05033d087c5ce514c64bab3319f32d018eb4834",id:this.listboxId,role:"listbox",viewClass:f.be("suggestion","list"),wrapClass:f.be("suggestion","wrap")},i("ul",{key:"8c23cf381478416a8af161140324b09bc3daabad"},!this.hideLoading&&this.loading?i("li",{id:`${this.listboxId}-loading`},this.loadingRender?this.handleLoadingRender():i("zane-icon",{class:f.is("loading"),name:"loading",spin:!0})):this.handleSuggestionsRender(this.suggestions))),this.hasFooter&&i("div",{key:"94f78d37a425c93494f757f366c971daf29463ad",class:f.be("suggestion","footer"),onClick:e=>e.stopPropagation()},i("slot",{key:"767209e0347c4f5d37a056affc13e257464e301a",name:"footer"}))))))}getInputDisabled(){var e,t,i;return null!==(i=null!==(e=this.disabled)&&void 0!==e?e:null===(t=this.formContext)||void 0===t?void 0:t.disabled)&&void 0!==i&&i}handleSuggestionsRender(e){return e.map((e,t)=>i("li",{"aria-selected":this.highlightedIndex===t,class:{highlighted:this.highlightedIndex===t},id:`${this.listboxId}-item-${t}`,key:`${this.listboxId}-item-${t}`,onClick:()=>this.handleSelect(e),role:"option"},this.suggestionRender?this.handleSuggestionItemRender(e,t):e[this.valueKey]))}get el(){return o(this)}};v.style=".zane-autocomplete{--zane-input-text-color:var(--zane-text-color-regular);--zane-input-border:var(--zane-border);--zane-input-hover-border:var(--zane-border-color-hover);--zane-input-focus-border:var(--zane-color-primary);--zane-input-transparent-border:0 0 0 1px transparent inset;--zane-input-border-color:var(--zane-border-color);--zane-input-border-radius:var(--zane-border-radius-base);--zane-input-bg-color:var(--zane-fill-color-blank);--zane-input-icon-color:var(--zane-text-color-placeholder);--zane-input-placeholder-color:var(--zane-text-color-placeholder);--zane-input-hover-border-color:var(--zane-border-color-hover);--zane-input-clear-hover-color:var(--zane-text-color-secondary);--zane-input-focus-border-color:var(--zane-color-primary);--zane-input-width:100%}.zane-autocomplete{width:var(--zane-input-width);position:relative;display:inline-block}.zane-autocomplete-suggestion{border-radius:var(--zane-border-radius-base);box-sizing:border-box}.zane-autocomplete-suggestion .zane-autocomplete-suggestion__header{padding:10px;border-bottom:1px solid var(--zane-border-color-lighter)}.zane-autocomplete-suggestion .zane-autocomplete-suggestion__footer{padding:10px;border-top:1px solid var(--zane-border-color-lighter)}.zane-autocomplete-suggestion .zane-autocomplete-suggestion__wrap{max-height:280px;padding:10px 0;box-sizing:border-box}.zane-autocomplete-suggestion .zane-autocomplete-suggestion__list{margin:0;padding:0}.zane-autocomplete-suggestion .zane-autocomplete-suggestion__list>div{height:100px;display:flex;align-items:center;justify-content:center;font-size:20px}.zane-autocomplete-suggestion ul{list-style:none;margin:0;padding:0}.zane-autocomplete-suggestion li{padding:0 20px;margin:0;line-height:34px;cursor:pointer;color:var(--zane-text-color-regular);font-size:var(--zane-font-size-base);list-style:none;text-align:left;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.zane-autocomplete-suggestion li:hover{background-color:var(--zane-fill-color-light)}.zane-autocomplete-suggestion li.highlighted{background-color:var(--zane-fill-color-light)}.zane-autocomplete-suggestion li.divider{margin-top:6px;border-top:1px solid var(--zane-color-black)}.zane-autocomplete-suggestion li.divider:last-child{margin-bottom:-6px}.zane-autocomplete-suggestion.is-loading li{cursor:default;height:100px;display:flex;align-items:center;justify-content:center;font-size:20px;color:var(--zane-text-color-secondary)}.zane-autocomplete-suggestion.is-loading li:hover{background-color:var(--zane-bg-color-overlay)}.zane-tooltip-box[data-theme~=autocomplete]{background-color:var(--zane-bg-color-overlay);border:1px solid var(--zane-border-color-lighter)}.zane-tooltip-box[data-theme~=autocomplete] .zane-tooltip-content{padding:0}";export{v as zane_autocomplete};
