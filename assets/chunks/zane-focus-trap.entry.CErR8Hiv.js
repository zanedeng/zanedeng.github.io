import{a as e,d as t,b as s,g as o}from"./theme.BxpiuCfN.js";import"./uuid-BZTOj-_U.D3oPmf8g.js";import"./framework.N_gL8lMw.js";const n=(e,t)=>{if("hidden"===getComputedStyle(e).visibility)return!0;let s=e;for(;s;){if(t&&s===t)return!1;if("none"===getComputedStyle(s).display)return!0;s=s.parentElement}return!1},a=(e,t)=>{for(const s of e)if(!n(s,t))return s;return null},i=e=>{const t=[],s=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:e=>{const t="INPUT"===e.tagName&&"hidden"===e.type;return e.disabled||e.hidden||t?NodeFilter.FILTER_SKIP:e.tabIndex>=0||e===document.activeElement?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;s.nextNode();)t.push(s.currentNode);return t},r="focusAfterTrapped",c="focusAfterReleased";let u,d=0,p=0,h=0;const f=()=>{u="pointer",d=window.performance.now()},l=()=>{u="keyboard",d=window.performance.now()},m=()=>({connect:()=>{0===h&&(document.addEventListener("mousedown",f),document.addEventListener("touchstart",f),document.addEventListener("keydown",l)),h++},disconnect:()=>{h--,h<=0&&(document.removeEventListener("mousedown",f),document.removeEventListener("touchstart",f),document.removeEventListener("keydown",l))},getFocusReason:()=>u,getLastAutomatedFocusTimestamp:()=>p,getLastUserFocusTimestamp:()=>d,isFocusCausedByUserEvent:()=>d>p,tryFocus:(e,t)=>{if(e&&"focus"in e){const s=document.activeElement;e.focus({preventScroll:!0}),p=window.performance.now(),e!==s&&(e=>e instanceof HTMLInputElement&&"select"in e)(e)&&t&&e.select()}}}),F=e=>new CustomEvent("focusout-prevented",{bubbles:!1,cancelable:!0,detail:e});function v(e,t){const s=[...e],o=e.indexOf(t);return-1!==o&&s.splice(o,1),s}const T=(()=>{let e=[];return{push:t=>{const s=e[0];s&&t!==s&&s.pause(),e=v(e,t),e.unshift(t)},remove:t=>{var s,o;e=v(e,t),null===(o=null===(s=e[0])||void 0===s?void 0:s.resume)||void 0===o||o.call(s)}}})(),E=class{constructor(s){e(this,s),this.zaneFocusAfterReleased=t(this,"zFocusAfterReleased",7),this.zaneFocusAfterTrapped=t(this,"zFocusAfterTrapped",7),this.zaneFocusin=t(this,"zFocusIn",7),this.zaneFocusout=t(this,"zFocusOut",7),this.zaneFocusoutPrevented=t(this,"zFocusOutPrevented",7),this.zaneReleaseRequested=t(this,"zReleaseRequested",7),this.focusStartEl="first",this.loop=!1,this.trapOnFocusIn=!0,this.trapped=!1,this.focusLayer={pause:()=>{this.focusLayer.paused=!0},paused:!1,resume:()=>{this.focusLayer.paused=!1}},this.focusReason=m(),this.lastFocusAfterTrapped=null,this.lastFocusBeforeTrapped=null,this.focusFirstDescendant=(e,t=!1)=>{const s=document.activeElement;for(const o of e)if(this.focusReason.tryFocus(o,t),document.activeElement!==s)return},this.onFocusIn=e=>{const t=this.getTrapContainer();if(!t)return;const s=e.target,o=e.relatedTarget,n=s&&t.contains(s);if(!this.trapped){o&&t.contains(o)||(this.lastFocusBeforeTrapped=o)}n&&this.zaneFocusin.emit(e),this.focusLayer.paused||this.trapped&&(n?this.lastFocusAfterTrapped=s:this.focusReason.tryFocus(this.lastFocusAfterTrapped,!0))},this.onFocusOut=e=>{const t=this.getTrapContainer();if(!this.focusLayer.paused&&t)if(this.trapped){const s=e.relatedTarget;s&&!t.contains(s)&&setTimeout(()=>{if(!this.focusLayer.paused&&this.trapped){const e=F({focusReason:this.focusReason.getFocusReason()});this.zaneFocusoutPrevented.emit(e),e.defaultPrevented||this.focusReason.tryFocus(this.lastFocusAfterTrapped,!0)}},0)}else{const s=e.target;s&&t.contains(s)||this.zaneFocusout.emit(e)}},this.onKeydown=e=>{if(!this.loop&&!this.trapped)return;if(this.focusLayer.paused)return;const{altKey:t,ctrlKey:s,currentTarget:o,metaKey:n,shiftKey:r}=e,{loop:c}=this,u=e.code||e.key,d="Tab"===u&&!t&&!s&&!n,p=document.activeElement;if(d&&p){const t=o,[s,n]=(e=>{const t=i(e);return[a(t,e),a(t.reverse(),e)]})(t);if(s&&n)if(r||p!==n){if(r&&[t,s].includes(p)){const t=F({focusReason:this.focusReason.getFocusReason()});this.zaneFocusoutPrevented.emit(t),t.defaultPrevented||(e.preventDefault(),c&&this.focusReason.tryFocus(n,!0))}}else{const t=F({focusReason:this.focusReason.getFocusReason()});this.zaneFocusoutPrevented.emit(t),t.defaultPrevented||(e.preventDefault(),c&&this.focusReason.tryFocus(s,!0))}else if(p===t){const t=F({focusReason:this.focusReason.getFocusReason()});this.zaneFocusoutPrevented.emit(t),t.defaultPrevented||e.preventDefault()}}"Escape"===u&&this.trapped&&!this.focusLayer.paused&&this.zaneReleaseRequested.emit(e)}}componentDidLoad(){this.initializeFocusTrap(),this.focusReason.connect()}disconnectedCallback(){this.cleanupEventListeners(),this.focusReason.disconnect(),this.trapped&&this.stopTrap()}onFocusTrapElChange(){this.cleanupEventListeners(),this.initializeFocusTrap()}onTrappedChange(e,t){e!==t&&(e?this.startTrap():this.stopTrap())}render(){return s("slot",{key:"c8878bbe0a33f352afd34d1559eb25ca1ef3410e"})}async updateFocusTrap(){this.trapped&&this.startTrap()}cleanupEventListeners(){const e=this.getTrapContainer();e&&(e.removeEventListener("keydown",this.onKeydown),e.removeEventListener("focusin",this.onFocusIn),e.removeEventListener("focusout",this.onFocusOut))}getTrapContainer(){return this.focusTrapEl||this.el}initializeFocusTrap(){const e=this.getTrapContainer();e&&(e.addEventListener("keydown",this.onKeydown),e.addEventListener("focusin",this.onFocusIn),e.addEventListener("focusout",this.onFocusOut)),this.trapped&&this.startTrap()}async startTrap(){await new Promise(e=>setTimeout(e,0));const e=this.getTrapContainer();if(e){T.push(this.focusLayer);const t=e.contains(document.activeElement)?this.lastFocusBeforeTrapped:document.activeElement;this.lastFocusBeforeTrapped=t;if(!e.contains(t)){const s=new CustomEvent(r,{bubbles:!1,cancelable:!0}),o=t=>{this.zaneFocusAfterTrapped.emit(t),e.removeEventListener(r,o)};e.addEventListener(r,o),e.dispatchEvent(s),s.defaultPrevented||setTimeout(()=>{let s=this.focusStartEl;"string"!=typeof s&&(this.focusReason.tryFocus(s),document.activeElement!==s&&(s="first")),"first"===s&&this.focusFirstDescendant(i(e),!0),document.activeElement!==t&&"container"!==s||this.focusReason.tryFocus(e)},0)}}}stopTrap(){var e;const t=this.getTrapContainer();if(t){const s=new CustomEvent(c,{bubbles:!1,cancelable:!0,detail:{focusReason:this.focusReason.getFocusReason()}}),o=e=>{this.zaneFocusAfterReleased.emit(e),t.removeEventListener(c,o)};if(t.addEventListener(c,o),t.dispatchEvent(s),!s.defaultPrevented){"keyboard"!==this.focusReason.getFocusReason()&&this.focusReason.isFocusCausedByUserEvent()&&!t.contains(document.activeElement)||this.focusReason.tryFocus(null!==(e=this.lastFocusBeforeTrapped)&&void 0!==e?e:document.body)}T.remove(this.focusLayer),this.lastFocusBeforeTrapped=null,this.lastFocusAfterTrapped=null}}get el(){return o(this)}static get watchers(){return{focusTrapEl:[{onFocusTrapElChange:0}],trapped:[{onTrappedChange:0}]}}};E.style='@charset "UTF-8";:host{display:contents;}';export{E as zane_focus_trap};
