import{o as t,a as e,f as s,b as i,c as o}from"./floating-ui.dom-Ivb1APnD.bJwPZhKF.js";import{l as r}from"./lodash-BTbln26t.B60hk6q5.js";class h{constructor(h,n="hover",a,l,c=0,p=0,d,g,f,m=200,v=300,u){this.computePosition=()=>{if(!this.triggerRef||!this.contentRef)return void console.warn("Popover: triggerRef or contentRef is not found");if(!this.open)return;const r=[];let h=this.offset;if(this.arrowRef){const t=this.arrowRef.offsetWidth;h+=Math.sqrt(2*t**2)/2}r.push(t({alignmentAxis:-this.contentPadding,crossAxis:-this.contentPadding,mainAxis:h+this.contentPadding}));const n=this.placements?this.placements.split(","):[],a=n[0];if(0===n.length)r.push(e());else{const t=n.splice(1);r.push(s({fallbackPlacements:t}))}this.arrowRef&&r.push(i({element:this.arrowRef})),o(this.triggerRef,this.contentRef,{middleware:r,placement:a}).then(({middlewareData:t,placement:e,strategy:s,x:i,y:o})=>{const[r,h]=e.split("-"),n={};n.left=`${i}px`,n.top=`${o}px`,n.position="fixed"===s?"fixed":"absolute";let a=0,l=0;if("top"===r||"bottom"===r?("top"===r?a=-2:"bottom"===r&&(a=2),"start"===h?l=2:"end"===h&&(l=-2)):"left"!==r&&"right"!==r||("left"===r?l=-2:"right"===r&&(l=2),"start"===h?a=-2:"end"===h&&(a=2)),this.contentRef.style.setProperty("--popover-content-shadow",`drop-shadow(${l}px ${a}px 2px rgba(0, 0, 0, 0.2))`),Object.assign(this.contentRef.style,n),t.arrow){const{x:e,y:s}=t.arrow,i={bottom:"top",left:"right",right:"left",top:"bottom"}[r];Object.assign(this.arrowRef.style,{bottom:"",left:null===e?"":`${e}px`,right:"",[i]:-this.arrowRef.offsetWidth/2+"px",top:null===s?"":`${s}px`})}})},this.computePositionThrottle=r.throttle(this.computePosition,80,{leading:!0,trailing:!0}),this.hidePopover=()=>{this.open&&(this.open=!1,this.hideCallback())},this.mouseleaveHandler=t=>{var e;const s=(null!==(e=t.path)&&void 0!==e?e:t.composedPath()).find(t=>t===this.host);if(s){setTimeout(()=>{const t=document.querySelectorAll(":hover");Array.prototype.indexOf.call(t,s)<0&&this.hidePopover()},this.dismissTimeout)}else this.hidePopover()},this.showPopover=()=>{this.open||("hover"===this.trigger?setTimeout(()=>{this.triggerRef.matches(":hover")&&this.showCallback()},this.openTimeout):this.showCallback())},this.windowClickHandler=t=>{if(("click"===this.trigger||"hover"===this.trigger)&&this.open){const e=t.path||t.composedPath();for(const t of e)if(t===this.host||this.triggers.includes(t))return;this.hidePopover()}},this.host=h,this.open=a,this.trigger=n,this.contentRef=l,this.offset=c,this.arrowRef=u,this.placements=f,this.openTimeout=m,this.dismissTimeout=v,this.triggers=[],this.showCallback=d,this.hideCallback=g,this.contentPadding=p,this.observer=new IntersectionObserver(()=>this.intersectingCallback(),{threshold:[0,1]}),this.observer.observe(this.contentRef)}destroy(){this.observer.disconnect(),this.observer=null}intersectingCallback(){this.open&&this.computePositionThrottle("onTriggerIntersection")}registerTarget(t){if(!t)throw new Error("The trigger element for the popover is not found.");this.triggers.includes(t)||(this.observer.observe(t),"hover"===this.trigger?(t.addEventListener("focus",()=>{this.triggerRef=t,this.showPopover()}),t.addEventListener("blur",()=>this.hidePopover()),t.addEventListener("mouseenter",()=>{this.triggerRef=t,this.showPopover()}),t.addEventListener("mouseleave",this.mouseleaveHandler)):"click"===this.trigger&&("ZANE-BUTTON"===t.nodeName?t.addEventListener("zane-button--click",()=>{this.open?this.hidePopover():this.showPopover()}):t.addEventListener("click",()=>{this.open?this.hidePopover():this.showPopover()})),this.triggers.push(t))}setOpen(t){this.open=t}setTriggerRef(t){this.triggerRef=t}}export{h as P};
